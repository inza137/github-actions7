name: Python CI & Artifact Upload 🧪📄

on:
  push: # Run on pushes to any branch
    branches:
      - main # Or your default branch
      - develop
  pull_request: # Run on pull requests targeting main or develop
    branches:
      - main
      - develop
  workflow_dispatch: # Allows manual triggering from the GitHub Actions tab

jobs:
  build-run-and-upload:
    runs-on: ubuntu-latest # Use the latest Ubuntu runner

    steps:
      - name: Checkout repository 🛎️
        uses: actions/checkout@v4
        # This step checks out your repository's code so the workflow can access it.

      - name: Set up Python 🐍
        uses: actions/setup-python@v5
        with:
          python-version: '3.8' # Matches the version in your pyproject.toml (tool.mypy)
          cache: 'pip' # Cache pip dependencies for faster builds

      - name: Install dependencies ⚙️
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # If your main script relied on dev dependencies, you would install them too:
          # pip install -r requirements-dev.txt

      - name: Run Python script to generate CSV 🏃‍♂️💨
        run: python src/main.py
        # This command executes your main.py script.
        # Based on your script, this should generate 'data/processed_output.csv'
        # and 'data/sample_input.csv' (if input isn't found), plus a log file.

      - name: Upload Processed CSV as Artifact 📤
        uses: actions/upload-artifact@v4
        with:
          name: processed-data-csv # The name of the artifact bundle that will appear in GitHub
          path: data/processed_output.csv # Path to the file to be uploaded.
                                          # Your script creates this in 'data/processed_output.csv' relative to the project root.
          if-no-files-found: error # What to do if the file isn't found: 'error', 'warn', or 'ignore'. 'error' will fail the step.
          retention-days: 7 # Optional: How long to keep the artifact (default is 90 days for public repos)

      - name: Upload All Data Files as Artifact (Alternative/Optional) 📂
        if: always() # Run this step even if previous steps fail (e.g., to upload logs) - use with caution or for specific needs.
        uses: actions/upload-artifact@v4
        with:
          name: all-data-files
          path: data/ # You can also upload an entire directory
          retention-days: 7